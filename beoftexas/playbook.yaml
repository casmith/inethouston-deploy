- name: Deploy Benefit Elect of Texas website via Docker
  hosts: web01
  become: yes
  tasks:
  
    - name: Creates directory
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
      loop:
        - /root/beoftexas/data
        - /root/beoftexas/data/nginx
        - /root/beoftexas/data/certbot
        - /root/beoftexas/secret

    - name: copy secrets
      copy:
        src: "../secret/{{ item }}"
        dest: "/root/beoftexas/secret/{{ item }}"
      loop:
      - beoftexas_db_pw.txt
      - beoftexas_db_root_pw.txt

          #    - name: copy Docker Compose files
          #      copy:
          #        src: "{{ item }}"
          #        dest: "/root/beoftexas/{{ item }}"
          #      loop:
          #      - docker-compose.yaml


          #    - name: copy nginx config
          #      copy:
          #        src: "{{ item }}"
          #        dest: "/root/beoftexas/{{ item }}"
          #      loop:
          #      - data/nginx/app.conf

          #    - name: Create and start services
          #      community.docker.docker_compose_v2:
          #        project_src: /root/beoftexas
          #      register: output
          #

    - name: copy scripts
      copy:
        src: "scripts/{{ item }}"
        dest: "/root/beoftexas/{{ item }}"
      loop:
        - backup.sh

    - name: Create backup cronjob
      ansible.builtin.cron:
        name: "check dirs"
        minute: "0"
        hour: "0"
        job: "/root/beoftexas/backup.sh > /dev/null"
